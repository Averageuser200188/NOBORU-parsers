MangaTown=Parser:new("MangaTown","https://www.mangatown.com","ENG","MANGATOWNEN",3)MangaTown.Filters={{Name="Demographic",Type="radio",Tags={"Show All","Shounen","Seinen","Shoujo","Yaoi","Shoujo Ai","Josei","Shounen Ai","Yuri"}},{Name="Genres",Type="checkcross",Tags={"4 Koma","Action","Adventure","Comedy","Cooking","Doujinshi","Drama","Ecchi","Fantasy","Gender Bender","Harem","Historical","Horror","Josei","Lolicon","Martial Arts","Mature","Mecha","Music","Mystery","One Shot","Psychological","Reverse Harem","Romance","School Life","Sci Fi","Sci-fi","Seinen","Shotacon","Shoujo","Shoujo Ai","Shounen","Shounen Ai","Slice Of Life","Smut","Sports","Supernatural","Suspense","Tragedy","Vampire","Webtoons","Youkai","4 Koma","Action","Adventure","Comedy","Cooking","Doujinshi","Drama","Ecchi","Fantasy","Gender Bender","Harem","Historical","Horror","Josei","Lolicon","Martial Arts","Mature","Mecha","Music","Mystery","One Shot","Psychological","Reverse Harem","Romance","School Life","Sci Fi","Sci-fi","Seinen","Shotacon","Shoujo","Shoujo Ai","Shounen","Shounen Ai","Slice Of Life","Smut","Sports","Supernatural","Suspense","Tragedy","Vampire","Webtoons","Youkai"}},{Name="Completed Series",Type="radio",Tags={"Show All","Yes","No"}}}MangaTown.DemogKeys={["Shounen"]="SHOUNEN",["Seinen"]="SEİNEN",["Shoujo"]="SHOUJO",["Yaoi"]="YAOİ",["Shoujo Ai"]="SHOUJO Aİ",["Josei"]="JOSEİ",["Shounen Ai"]="SHOUNEN Aİ",["Yuri"]="YURİ",["Show All"]=""}MangaTown.Completed={["Yes"]="1",["No"]="0",["Show All"]=""}local function a(string)return string:gsub("&#([^;]-);",function(b)local c=tonumber("0"..b)or tonumber(b)return c and u8c(c)or"&#"..b..";"end):gsub("&(.-);",function(b)return HTML_entities and HTML_entities[b]and u8c(HTML_entities[b])or"&"..b..";"end)end;local function d(e)local f={}Threads.insertTask(f,{Type="StringRequest",Link=e,Table=f,Index="text"})while Threads.check(f)do coroutine.yield(false)end;return f.text or""end;function MangaTown:getManga(e,g)local h=d(e)g.NoPages=true;for i,j,k in h:gmatch('cover".-src="([^"]-)".-href="([^"]-)" title="([^>]-)">')do g[#g+1]=CreateManga(a(k),j,i,self.ID,self.Link..j)g.NoPages=false;coroutine.yield(false)end end;function MangaTown:getPopularManga(l,g)self:getManga(self.Link.."/hot/"..l..".htm",g)end;function MangaTown:getLatestManga(l,g)self:getManga(self.Link.."/new/"..l..".htm",g)end;function MangaTown:searchManga(m,l,g,n)local o="page="..l.."&name="..m;if n then local p=n["Genres"]local q=n["Demographic"]local r=n["Completed Series"]if p then for s,t in ipairs(p.include)do o=o.."&".."genres%5B"..t:gsub(" ","+").."%5D=1"end;for s,t in ipairs(p.exclude)do o=o.."&".."genres%5B"..t:gsub(" ","+").."%5D=2"end end;if q and self.DemogKeys[q]~=""then o=o.."&".."demographic="..self.DemogKeys[q]:gsub("[^a-zA-Z]",function(b)return string.format("%%%x",string.byte(b))end)end;if r and self.Completed[r]~=""then o=o.."&".."is_completed="..self.Completed[r]end end;self:getManga(self.Link.."/search?"..o,g)end;function MangaTown:getChapters(u,g)local h=d(self.Link..u.Link)local v={}local w=h:match('id="show"[^>]->(.-)<a')or""g.Description=a(w)for j,k,x in h:gmatch('href="([^"]-)" name=".-">%s*(.-)%s*</a>(.-)</li>')do x=x:gsub('<span class="time">(.-)</span>',""):gsub("<[^>]->",""):gsub(" +"," ")if x~=" "and x~=""then k=k.." -"..x end;v[#v+1]={Name=a(k),Link=j,Pages={},Manga=u}end;for y=#v,1,-1 do g[#g+1]=v[y]end end;function MangaTown:prepareChapter(z,g)local A=d(self.Link..z.Link.."1.html"):match("total_pages = (.-);")or 0;for y=1,A do g[y]=self.Link..z.Link..y..".html"end end;function MangaTown:loadChapterPage(e,g)g.Link=d(e):match('img src="//([^"]-)"')end