MangaLibros=Parser:new("MangaLibros","http://mangalibros.com","ESP","MANGALIBROSESP",1)local function a(b)return b:gsub("&#([^;]-);",function(c)local d=tonumber("0"..c)or tonumber(c)return d and u8c(d)or"&#"..c..";"end):gsub("&(.-);",function(c)return HTML_entities and HTML_entities[c]and u8c(HTML_entities[c])or"&"..c..";"end)end;local function e(b)return b:gsub("\\u(....)",function(c)return u8c(tonumber("0x"..c))end)end;local function f(g)local h={}Threads.insertTask(h,{Type="StringRequest",Link=g,Table=h,Index="text"})while Threads.check(h)do coroutine.yield(false)end;return h.text or""end;function MangaLibros:getManga(g,i)local j=f(g)i.NoPages=true;for k,l,m in j:gmatch('<a href="[^"]-/manga/([^"]-)" class="thumbnail">[^>]-src=\'([^\']-)\' alt=\'([^\']-)\'>[^<]-</a>')do i[#i+1]=CreateManga(a(m),k,l,self.ID,k)i.NoPages=false;coroutine.yield(false)end end;function MangaLibros:getPopularManga(n,i)self:getManga(self.Link.."/filterList?page="..n.."&cat=&alpha=&sortBy=views&asc=true&author=&tag=",i)end;function MangaLibros:getAZManga(n,i)self:getManga(self.Link.."/filterList?page="..n.."&cat=&alpha=&sortBy=name&asc=true&author=&tag=",i)end;function MangaLibros:searchManga(o,p,i)local j=f(self.Link.."/search?query="..o)for m,k in j:gmatch('"value":"([^"]-)","data":"([^"]-)"')do i[#i+1]=CreateManga(e(m),k,self.Link.."/uploads/manga/"..k.."/cover/cover_250x350.jpg",self.ID,k)coroutine.yield(false)end;i.NoPages=true end;function MangaLibros:getChapters(q,i)local j=f(self.Link.."/manga/"..q.Link)local r={}local s=(j:match('class="well">(.-)</div>')or""):gsub("^\n*",""):gsub("\n*$",""):gsub("<[^>]->","")i.Description=a(s or"")for k,m,t in j:gmatch('class="chapter%-title%-.-href="[^"]-/manga/([^"]-)">([^<]-)</a>(.-)</h5>')do t=t or""r[#r+1]={Name=a(m..t):gsub("<[^>]->",""):gsub("%s+"," "),Link=k,Pages={},Manga=q}end;for u=#r,1,-1 do i[#i+1]=r[u]end end;function MangaLibros:prepareChapter(v,i)local j=f(self.Link.."/manga/"..v.Link)for k in j:gmatch('"page_image":"\\/image\\/([^"]-)"')do i[#i+1]={Link=self.Link.."/image/"..k,Header1="Referer: "..self.Link}end end;function MangaLibros:loadChapterPage(g,i)i.Link=g end