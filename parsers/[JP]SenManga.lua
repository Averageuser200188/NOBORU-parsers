SenManga=Parser:new("SenManga","https://raw.senmanga.com","JAP","SENGMANGAJAP",2)SenManga.Filters={{Name="Sort By",Type="radio",Tags={"Title","Total Views","Rank","Last Update"}},{Name="Genre",Type="checkcross",Tags={"Action","Adult","Adventure","Comedy","Cooking","Drama","Ecchi","Fantasy","Gender Bender","Harem","Historical","Horror","Josei","Light Novel","Magazine","Martial Arts","Mature","Music","Mystery","Psychological","Romance","School Life","Sci-Fi","Seinen","Shoujo","Shoujo Ai","Shounen","Shounen Ai","Slice of Life","Smut","Sports","Supernatural","Tragedy","Webtoons","Yaoi","Yuri"}},{Name="Completed",Type="radio",Tags={"Yes","No"},Default="No"}}SenManga.Sorts={["Title"]="title",["Total Views"]="total_views",["Rank"]="rank",["Last Update"]="last_update"}local function a(b)return b:gsub("&#([^;]-);",function(c)local d=tonumber("0"..c)or tonumber(c)return d and u8c(d)or"&#"..c..";"end):gsub("&(.-);",function(c)return HTML_entities and HTML_entities[c]and u8c(HTML_entities[c])or"&"..c..";"end)end;local function e(f)local g={}Threads.insertTask(g,{Type="StringRequest",Link=f,Table=g,Index="text"})while Threads.check(g)do coroutine.yield(false)end;return g.text or""end;function SenManga:getManga(f,h,i,j)local k=e(f)local l=j and"series"or"border%-light"for m,n,o in k:gmatch(l..'">.-href="(%S-)".-src="(%S-)" alt="([^"]-)"')do h[#h+1]=CreateManga(a(o),m:match(self.Link.."/(.*)$"),n:gsub("%%","%%%%"),self.ID,m)coroutine.yield(false)end;if i==tonumber(k:match('^.*page=(%d*)">.-$')or 1)then h.NoPages=true end end;function SenManga:getPopularManga(i,h)self:getManga(self.Link.."/directory/popular?page="..i,h,i)end;function SenManga:getLatestManga(i,h)self:getManga(self.Link.."/directory/last_update?page="..i,h,i)end;function SenManga:searchManga(j,i,h,p)local q=""local r=""local s=0;local t="title"if p then t=self.Sorts[p["Sort By"]]q=table.concat(p["Genre"].include,"%%2C"):gsub(" ","+")r=table.concat(p["Genre"].exclude,"%%2C"):gsub(" ","+")s=p["Completed"]=="Yes"and 1 or 0 end;self:getManga(self.Link.."/search?s="..j.."&author=&artist=&genre="..q.."&nogenre="..r.."&completed="..s.."&released=&page="..i.."&sort="..t,h,i,true)end;function SenManga:getChapters(u,h)local k=e(self.Link.."/"..u.Link)local v=(k:match('<span itemprop="description">(.-)</span>')or""):gsub("<br>","\n"):gsub("<.->",""):gsub("\n+","\n"):gsub("^%s+",""):gsub("%s+$","")h.Description=a(v)local w={}for m,o in k:gmatch('class="element">[^>]-class="title">[^<]-<a href="(%S-)">[\n%s]*(.-)[\n%s]*</a>')do w[#w+1]={Name=a(o),Link=m:match(self.Link.."/(.*)"),Pages={},Manga=u}end;for x=#w,1,-1 do h[#h+1]=w[x]end end;function SenManga:prepareChapter(y,h)local k=e(self.Link.."/"..y.Link)for x=1,tonumber(k:match(" of (%d*)")or 0)do h[#h+1]=self.Link.."/viewer/"..y.Link.."/"..x end end;function SenManga:loadChapterPage(f,h)h.Link=f end