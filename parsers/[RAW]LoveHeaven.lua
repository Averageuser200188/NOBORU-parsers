LoveHeaven=Parser:new("LoveHeaven","https://loveheaven.net","RAW","LOVEHEAVENRAW",1)local function a(b)return b:gsub("&#([^;]-);",function(c)local d=tonumber("0"..c)or tonumber(c)return d and u8c(d)or"&#"..c..";"end):gsub("&(.-);",function(c)return HTML_entities and HTML_entities[c]and u8c(HTML_entities[c])or"&"..c..";"end)end;local e='https://loveheaven.net/manga-list.html?listType=pagination&page=%s&artist=&author=&group=&m_status=&name=&genre=&ungenre=&sort=%s&sort_type=%s'local f='https://loveheaven.net/manga-list.html?listType=pagination&page=%s&artist=&author=&group=&m_status=&name=%s&genre=&ungenre=&sort=views&sort_type=DESC'local function g(h,i,j)return e:format(h,i,j)end;local function k(h,l)return f:format(h,l)end;local function m(n)local o={}Threads.insertTask(o,{Type="StringRequest",Link=n,Table=o,Index="text"})while Threads.check(o)do coroutine.yield(false)end;return o.text or""end;function LoveHeaven:getManga(n,p)local q=m(n)p.NoPages=true;local r,s=q:match("Page (%d+) of (%d+)")for t,u,v in q:gmatch('<div class="col%-lg%-12 col%-md%-12.-href="(.-)".-data%-src="([^"]-)" alt="([^"]-)"')do p[#p+1]=CreateManga(a(v),t,{Link=u,Header1="Referer: https://loveheaven.net/manga-list.html"},self.ID,self.Link.."/"..t)if tonumber(r)<tonumber(s)then p.NoPages=false end;coroutine.yield(false)end end;function LoveHeaven:getPopularManga(h,p)self:getManga(g(h,"views","DESC"),p)end;function LoveHeaven:getLatestManga(h,p)self:getManga(g(h,"last_update","DESC"),p)end;function LoveHeaven:getAZManga(h,p)self:getManga(g(h,"name","DESC"),p)end;function LoveHeaven:searchManga(w,h,p)self:getManga(k(h,w),p)end;function LoveHeaven:getChapters(x,p)local q=m(self.Link.."/"..x.Link)local y={}for t,v in q:gmatch('<a class="chapter" href=\'([^\']-)\'.-<b>(.-)</b>')do y[#y+1]={Name=a(v),Link=t,Pages={},Manga=x}end;for z=#y,1,-1 do p[#p+1]=y[z]end end;function LoveHeaven:prepareChapter(A,p)local q=m(self.Link.."/"..A.Link)for t in q:gmatch('<img class=\'chapter%-img\' .-data%-src=\'([^\']-)\'')do p[#p+1]={Link=t:gsub("[\r\n]",""),Header1="Referer: https://loveheaven.net/manga-list.html"}end end;function LoveHeaven:loadChapterPage(n,p)p.Link=n end