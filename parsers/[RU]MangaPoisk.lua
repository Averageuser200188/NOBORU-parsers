MangaPoisk=Parser:new("МангаПоиск","https://mangapoisk.ru","RUS","MANGAPOISK",1)local function a(b)return b:gsub("&#([^;]-);",function(c)local d=tonumber("0"..c)or tonumber(c)return d and u8c(d)or"&#"..c..";"end):gsub("&(.-);",function(c)return HTML_entities and HTML_entities[c]and u8c(HTML_entities[c])or"&"..c..";"end)end;local function e(f)local g={}Threads.insertTask(g,{Type="StringRequest",Link=f,Table=g,Index="text"})while Threads.check(g)do coroutine.yield(false)end;return g.text or""end;function MangaPoisk:getManga(f,h)local i=e(f)h.NoPages=true;for j,k,l in i:gmatch('rounded">.-href="(%S-)".-src="(%S-)" class.-title pl%-1 h3">([^<]-)</h2>')do h[#h+1]=CreateManga(a(l),j,k,self.ID,self.Link..j)coroutine.yield(false)h.NoPages=false end end;function MangaPoisk:getPopularManga(m,n)self:getManga(self.Link.."/manga?page="..m,n)end;function MangaPoisk:getLatestManga(m,n)self:getManga(self.Link.."/manga?sortBy=-last_chapter_at&page="..m,n)end;function MangaPoisk:searchManga(o,m,n)self:getManga(self.Link.."/search?q="..o.."&page="..m,n)end;function MangaPoisk:getChapters(p,h)local i=e(self.Link..p.Link.."/chaptersList")local q={}for j,l,r in i:gmatch('d%-none.-href="(%S-)".-class="chapter%-title">\n(.-)</span>\n(.-)\n')do local s=r:gsub("%s+"," "):match("^%s*(.-)%s*$")q[#q+1]={Name=a(l:gsub("%s+"," "):match("^%s*(.-)%s*$"))..(s~=""and": "..s or""),Link=j,Pages={},Manga=p}end;for t=#q,1,-1 do h[#h+1]=q[t]end end;function MangaPoisk:prepareChapter(u,h)local i=e(self.Link..u.Link)for j in i:gmatch('data%-alternative="(%S-)"')do h[#h+1]=j end end;function MangaPoisk:loadChapterPage(f,h)h.Link=f end