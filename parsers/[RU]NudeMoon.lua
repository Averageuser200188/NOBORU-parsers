NudeMoon=Parser:new("Nude-Moon","https://nude-moon.net","RUS","NUDEMOONRU",4)NudeMoon.Filters={{Name="Жанр",Type="check",Tags={"Анал","Без цензуры","Беременные","Близняшки","Большие груди","В бассейне","В больнице","В ванной","В общественном месте","В первый раз","В транспорте","В туалете","Гарем","Гипноз","Горничные","Горячий источник","Групповой секс","Драма","Запредельное","Золотой дождь","Зрелые женщины","Идолы","Извращение","Измена","Имеют парня","Клизма","Колготки","Комиксы","Комиксы 3D","Косплей","Мастурбация","Мерзкий мужик","Много спермы","Молоко","Монстры","На камеру","На природе","Обычный секс","Огромный член","Пляж","Подглядывание","Принуждение","Продажность","Пьяные","Рабыни","Романтика","С ушками","Секс игрушки","Спящие","Страпон","Студенты","Суккуб","Тентакли","Толстушки","Трапы","Ужасы","Униформа","Учитель и ученик","Фемдом","Фетиш","Фурри","Футанари","Футфетиш","Фэнтези","Цветная","Чикан","Чулки","Шимейл","Эксгибиционизм","Юмор","Юри","Яой","Ahegao","BDSM","Ganguro","Gender bender","Megane","Mind break","Monstergirl","Netorare","Nipple penetration","Titsfuck","X-ray"}}}NudeMoon.Keys={["Анал"]="анал",["Без цензуры"]="без цензуры",["Беременные"]="беременные",["Близняшки"]="близняшки",["Большие груди"]="большие груди",["В бассейне"]="в бассейне",["В больнице"]="в больнице",["В ванной"]="в ванной",["В общественном месте"]="в общественном месте",["В первый раз"]="в первый раз",["В транспорте"]="в транспорте",["В туалете"]="в туалете",["Гарем"]="гарем",["Гипноз"]="гипноз",["Горничные"]="горничные",["Горячий источник"]="горячий источник",["Групповой секс"]="групповой секс",["Драма"]="драма",["Запредельное"]="запредельное",["Золотой дождь"]="золотой дождь",["Зрелые женщины"]="зрелые женщины",["Идолы"]="идолы",["Извращение"]="извращение",["Измена"]="измена",["Имеют парня"]="имеют парня",["Клизма"]="клизма",["Колготки"]="колготки",["Комиксы"]="комиксы",["Комиксы 3D"]="комиксы 3D",["Косплей"]="косплей",["Мастурбация"]="мастурбация",["Мерзкий мужик"]="мерзкий мужик",["Много спермы"]="много спермы",["Молоко"]="молоко",["Монстры"]="монстры",["На камеру"]="на камеру",["На природе"]="на природе",["Обычный секс"]="обычный секс",["Огромный член"]="огромный член",["Пляж"]="пляж",["Подглядывание"]="подглядывание",["Принуждение"]="принуждение",["Продажность"]="продажность",["Пьяные"]="пьяные",["Рабыни"]="рабыни",["Романтика"]="романтика",["С ушками"]="с ушками",["Секс игрушки"]="секс игрушки",["Спящие"]="спящие",["Страпон"]="страпон",["Студенты"]="студенты",["Суккуб"]="суккуб",["Тентакли"]="тентакли",["Толстушки"]="толстушки",["Трапы"]="трапы",["Ужасы"]="ужасы",["Униформа"]="униформа",["Учитель и ученик"]="учитель и ученик",["Фемдом"]="фемдом",["Фетиш"]="фетиш",["Фурри"]="фурри",["Футанари"]="футанари",["Футфетиш"]="футфетиш",["Фэнтези"]="фэнтези",["Цветная"]="цветная",["Чикан"]="чикан",["Чулки"]="чулки",["Шимейл"]="шимейл",["Эксгибиционизм"]="эксгибиционизм",["Юмор"]="юмор",["Юри"]="юри",["Яой"]="яой",["Ahegao"]="ahegao",["BDSM"]="BDSM",["Ganguro"]="ganguro",["Gender bender"]="gender bender",["Megane"]="megane",["Mind break"]="mind break",["Monstergirl"]="monstergirl",["Netorare"]="netorare",["Nipple penetration"]="nipple penetration",["Titsfuck"]="titsfuck",["X-ray"]="x-ray"}NudeMoon.NSFW=true;local function a(string)return string:gsub("&#([^;]-);",function(b)local c=tonumber("0"..b)or tonumber(b)return c and u8c(c)or"&#"..b..";"end):gsub("&(.-);",function(b)return HTML_entities and HTML_entities[b]and u8c(HTML_entities[b])or"&"..b..";"end)end;local function d(e)local f={}Threads.insertTask(f,{Type="StringRequest",Link=e,Table=f,Index="text",Header1="referer: https://www.google.com/"})while Threads.check(f)do coroutine.yield(false)end;return f.text or""end;local function g(table,h)for i,j in pairs(table)do if j==h then return true end end;return false end;function NudeMoon:getManga(e,k,l)local m=d(e)k.NoPages=true;local n='<td colspan.-<a[^>]-href="(.-)".-title="(.-)".-src="(.-)"'if l then n=n..'.-tag%-links(.-)</span>'end;for o,p,q,r in m:gmatch(n)do local s=true;if l then local t={}for u in r:gmatch("/tag/.->(.-)</a>")do t[#t+1]=AnsiToUtf8(u)end;for i,j in pairs(l[1])do if not g(t,self.Keys[j])then s=false;break end end end;if s then k[#k+1]=CreateManga(a(AnsiToUtf8(p)),o,q:find("^https")and q or self.Link..q,self.ID,self.Link..o)end;k.NoPages=false;if s then coroutine.yield(false)end end end;function NudeMoon:getLatestManga(v,k)self:getManga(self.Link.."/all_manga?rowstart="..(v-1)*30,k)end;function NudeMoon:getPopularManga(v,k)self:getManga(self.Link.."/all_manga?views&rowstart="..(v-1)*30,k)end;function NudeMoon:searchManga(w,v,k,t)local x={}if w==""and t and#t>0 and#t[1]>0 then local y=""for i,j in pairs(t[1])do y=y..self.Keys[j]:gsub(" ","_"):gsub(".",function(b)return"%%"..string.format("%x",string.byte(b))end).."_"end;self:getManga(self.Link.."/tags/"..y.."&rowstart="..(v-1)*30,k)else for z in it_utf8(w)do if utf8ascii[z]then x[#x+1]=utf8ascii[z]else x[#x+1]=z end end;x=table.concat(x)self:getManga(self.Link.."/search?stext="..x.."&rowstart="..(v-1)*30,k,t)end end;function NudeMoon:getChapters(A,k)local m=d(self.Link..A.Link)local e=m:match('"(/vse_glavy/[^"]-)"')if e then local B={}self:getManga(self.Link..e,B)for C=#B,1,-1 do local D=B[C]k[#k+1]={Name=a(D.Name),Link=D.Link:gsub("^(/%d*)","%1-online"),Pages={},Manga=A}end else k[#k+1]={Name=a(A.Name),Link=A.Link:gsub("^(/%d*)","%1-online"),Pages={},Manga=A}end end;function NudeMoon:prepareChapter(E,k)local m=d(self.Link..E.Link.."?page=1")for e in m:gmatch("images%[%d-%].src = '(.-)';")do if e:find("^https")then k[#k+1]=e else k[#k+1]=self.Link..e end end end;function NudeMoon:loadChapterPage(e,k)k.Link=e end